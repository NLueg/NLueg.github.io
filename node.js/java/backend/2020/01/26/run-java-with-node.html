<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name = "seobility" content = "e59159d2781145a4a5dcd36ae7c22882">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">

<link rel="stylesheet" href="/assets/css/style.css">
<link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico" />
<link rel="apple-touch-icon" href="/assets/favicon.ico" />

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

<title>Bridge between Java and NodeJs | Nico Lueg</title>

 




 
<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Bridge between Java and NodeJs - Homepage | Nico Lueg</title>
<meta property="og:title" content="Bridge between Java and NodeJs" />
<meta name="description" content="This post describes a problem I had while implementing the language-server for openVALIDATION: The usage of a JAR-file inside JavaScript. I will discuss my research and my found solutions that might fix the problem." />
<meta property="og:description" content="This post describes a problem I had while implementing the language-server for openVALIDATION: The usage of a JAR-file inside JavaScript. I will discuss my research and my found solutions that might fix the problem." />
<link rel="canonical" href="https://www.nicolueg.com/node.js/java/backend/2020/01/26/run-java-with-node.html" />
<meta property="og:url" content="https://www.nicolueg.com/node.js/java/backend/2020/01/26/run-java-with-node.html" />
<meta property="og:site_name" content="Homepage | Nico Lueg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-26T04:33:36+01:00" />
<meta name="google-site-verification" content="FNaaXWwsnfU4VXhQ8kaUQXERO5Lv0k5cUQsd4LdK5UU" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Bridge between Java and NodeJs",
"datePublished": "2020-01-26T04:33:36+01:00",
"description": "This post describes a problem I had while implementing the language-server for openVALIDATION: The usage of a JAR-file inside JavaScript. I will discuss my research and my found solutions that might fix the problem.",
"url": "https://www.nicolueg.com/node.js/java/backend/2020/01/26/run-java-with-node.html"}</script>
<!-- End Jekyll SEO tag -->
 
<style>
    #cookie-notice {
        padding: 7px 15px;
        display: none;
        text-align: center;
        position: fixed;
        bottom: 0;
        width: 100%;
        background: #222;
        color: rgba(255, 255, 255, 0.8);
        z-index: 10000;
    }
    
    #cookie-text {
        margin-bottom: 5px;
    }

    #cookie-text>div>a {
        color: #7c98ff;
    }
    
    #cookie-notice>a {
        cursor: pointer;
        margin-left: 10px;
        background-color: #e3e3e3;
        border-color: #e3e3e3;
        color: #222;
    }
    
    @media (max-width: 767px) {
        #cookie-text>div {
            display: block;
            padding-top: 3px;
            margin-bottom: 13px;
        }
        #cookie-notice>a {
            position: relative;
            bottom: 4px;
        }
    }
</style>
<div id="cookie-notice">
    <div id="cookie-text">
        <div>I use third party scripts to improve the functionality of this website. These scripts use some cookies.
        Namely I first use the Cloudflare-Protection which requires a <a href="https://support.cloudflare.com/hc/en-us/articles/200170156-What-does-the-Cloudflare-cfduid-cookie-do-">cookie</a> that can't be disabled.
        Also I use Google-Analytics as an indicator for how often the side is visited which also requires a few <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookies-user-id">cookies</a>.
        Last but not least I use Disqus as a commenting-framework which requires additional <a href="https://help.disqus.com/en/articles/1717155-use-of-cookies">cookies</a>.
        Most of the Google-Analytics-Cookies and all the Disqus-Cookies can be disabled by clicking the "Decline"-Button. </div>
    </div>
    <a id="cookie-notice-decline" class="btn btn-primary btn-sm">Decline</a>
    <a id="cookie-notice-accept" class="btn btn-primary btn-sm">Approve</a>
</div>
<script>
    var cookieAccecpted = false;

    function createCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function eraseCookie(name) {
        createCookie(name, "", -1);
    }

    if (readCookie('cookie-notice-dismissed') == 'true') {
        cookieAccecpted = true;
    } else {
        cookieAccecpted = false;
        $('#cookie-notice').show();
    }
    $('#cookie-notice-accept').click(function() {
        createCookie('cookie-notice-dismissed', 'true', 31);
        $('#cookie-notice').hide();
        location.reload();
    });
    $('#cookie-notice-decline').click(function() {
        $('#cookie-notice').hide();
    });
</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<link type="application/atom+xml" rel="alternate" href="https://www.nicolueg.com/feed.xml" title="Homepage | Nico Lueg" /><script>
        if (window.cookieAccecpted) {
            document.write('<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146687582-1"><\/script>');

            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());

            gtag('config', 'UA-146687582-1');
        }
    </script></head>

<body><nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/"><span class="logo-wrapper"></span></a>

    <button class="navbar-toggler toggler-example" type="button" data-toggle="collapse" data-target="#navbarSupportedContent1" aria-controls="navbarSupportedContent1" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent1">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
             
            <li class="nav-item active">
                <a class="nav-link" href="https://www.nicolueg.com/about">About Me</a>
            </li>
            
            <li class="nav-item active">
                <a class="nav-link" href="https://www.nicolueg.com/blog">Blog</a>
            </li>
            
            <li class="nav-item active">
                <a class="nav-link" href="https://www.nicolueg.com/categories">Categories</a>
            </li>
            
            <li class="nav-item active">
                <a class="nav-link" href="https://www.nicolueg.com/pantrist">Pantrist</a>
            </li>
            
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <div tabindex="-1" class="search-searchbar"></div>
<div class="search-hits bg-light"></div>
        </form>
    </div>
</nav>
<main class="container">
    <section class="content content-no-about">
        <script>
  //Linkifier for references
  window.onload = function () {
    var a,
      e,
      r,
      t,
      l = $("ol.bibliography > li > span");
    if (l)
      for (var n = 0; n < l.length; n++)
        l[n].innerHTML =
          ((a = l[n].innerHTML),
          (t = r = e = void 0),
          (e = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim),
          (r = /(^|[^\/])(www\.[\S]+(\b|$))/gim),
          (t = /(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim),
          a
            .replace(e, '<a href="$1" target="_blank">url</a>')
            .replace(r, '$1<a href="http://$2" target="_blank">url</a>')
            .replace(t, '<a href="mailto:$1">$1</a>'));
  };
</script><div class="post-container">
  <a class="post-link" href="/node.js/java/backend/2020/01/26/run-java-with-node.html">
    <h2 class="post-title">Bridge between Java and NodeJs</h2>
  </a>
  <div class="post-date">
    <i class="icon-calendar"></i>Jan 26, 2020 • 

7 minutes to read

  </div>
  <div class="post-meta">
    <div class="post-categories">
       
      <a href="/tag/Node.js"><code class="highligher-rouge"><nobr>Node.js</nobr></code> </a>
       
      <a href="/tag/Java"><code class="highligher-rouge"><nobr>Java</nobr></code> </a>
       
      <a href="/tag/backend"><code class="highligher-rouge"><nobr>backend</nobr></code> </a>
      
    </div>
  </div>
  <div class="post">
    <!-- Introduction: Description of the problem -->
<p>I recently worked on implementing a language-server for the DSL openVALIDATION.
The plan was, to deliver an IDE to simplify the usage of the language.
Because we wanted to implement a web-based IDE we couldn’t avoid using JavaScript or TypeScript for the editor.
We also preferred TypeScript for the implementation of the language-server to be more reusable.
The problem we then had is, that openVALIDATION is written in Java and we don’t want to duplicate the parsing logic to TypeScript.
So we needed to find a way to connect the Java implementation with the TypeScript language-server.</p>

<p>I will first explain the different ways I tried and will then come to my final solution: writing an own package.</p>

<h2 id="different-approaches">Different Approaches</h2>

<p>First, we created a REST-API, that the language-server can speak with the parser.
Implementing it in Java wasn’t the problem.
With the implemented REST-API, we can provide several paths for parsing and other required functions.</p>

<!-- Cloud: too expensive, working offline -->
<p>Then we thought about how to publish the API.
The usage of something like a cloud-based REST-API would lead to very high costs because every text-change of a user would call this Apis.
Also, we wanted the language-server to work independently from the internet for the integration in not web-based IDEs like VSCode.</p>

<!-- Starting of the REST-API is required, possible with java -->
<p>Because of this, we wanted to deliver the REST-API when the language-server gets installed and run it in a separate process.
This is also not much of a problem if Java is installed.
But openVALIDATION is a no-code development tool so what an editor would it be if it requires a programming-language to work with it?
So this is not an option either.</p>

<!-- We want to be language-independent -->
<p>My first thought was, that it shouldn’t be such a problem to run a JAR file without Java.
I thought about some programs that wrap the JAR to another format to be executed on any platform.
After some research I found <code class="highlighter-rouge">launch4j</code> <a class="citation" href="#launch4j">[1]</a>.
Launch4j is called a cross-platform tool for wrapping Java applications which sounds like a perfect fit for my needs.</p>

<!-- Launch4j -->
<p>So I downloaded it and tried it out.
The package works perfectly for wrapping the JAR for windows.
It creates an EXE-File which includes the JAR with an integrated JRE.
But I couldn’t find out, how to wrap a JAR platform-independent.
I discovered, that the ‘cross-platform’ says, that the tool itself can be launched on all platforms and NOT to use the JAR on all platforms.
There are some similar tools for Linux and Mac but this would lead to a large overhead if the package needs to deliver a wrapped JAR for every platform.
That’s why I discarded this idea too.</p>

<!-- found packages to do so -->
<p>Next, I searched for npm packages that deliver a bridge between JavaScript and Java.
I thought I can’t be the only one having this problem.
And I wasn’t!
Two packages try to solve this problem by downloading the platform-specific JRE while installing the package. 
This is the solution!</p>

<!-- problems with the packages -->
<p>But I still got a bit of a problem with the packages.
The first package <code class="highlighter-rouge">node-jre</code> <a class="citation" href="#node-jre">[2]</a> uses the official Oracle-JRE which, as far as I know, doesn’t fit to the Oracle license.
The second package <code class="highlighter-rouge">njre</code> <a class="citation" href="#njre">[3]</a> uses the OpenJDK from the <code class="highlighter-rouge">AdoptOpenJDK API</code> <a class="citation" href="#openJDK">[4]</a>.
With this package, I am secured from any licensing problems.
But both packages have a huge disadvantage which comes from the overhead which both packages bring to the dependent project.
The JRE is installed on every platform at any time even though there already is a Java installation on the PC.
Also, the path of the JRE varies on the different platforms because of the folder-structure of OpenJDK.
The dependent project needs to look for the downloaded JRE and run it.
In the end, I couldn’t find a project, that fits my expectations.</p>

<h2 id="solution-node-java-connector">Solution: <code class="highlighter-rouge">node-java-connector</code>
</h2>
<!-- Final solution: download OpenJDK -->
<p>So I decided to build an own package which should work like this:</p>

<ol>
  <li>When installing the package, the JRE gets downloaded.</li>
  <li>When a Java version exists on the system, the JRE won’t be downloaded.</li>
  <li>The OpenJDK JRE should be used to be saved from licensing problems.</li>
  <li>The package should provide an API for starting a given JAR file that the dependent package doesn’t have to the JRE by itself.</li>
</ol>

<p>While implementing it, I oriented myself on the the <code class="highlighter-rouge">njre</code> package.
Also, I used <code class="highlighter-rouge">find-java-home</code> <a class="citation" href="#findJavaHome">[5]</a> to look up, if the platform has Java installed or not.
If not, the JRE gets downloaded in the node-module itself.
This is also different from the other to packages where the JRE gets downloaded in the root folder of the dependent project.
Now you don’t publish the JRE in your package.</p>

<p>Also a function gets exported, that can be used to run the JAR.
The function itself then handles the finding of the JRE and can take some arguments too.</p>

<p>I already used the package in two projects in the context of openVALIDATION: <code class="highlighter-rouge">openvalidation-npm-cli</code> <a class="citation" href="#openvalidationNpm">[6]</a> and <code class="highlighter-rouge">openvalidation-languageserver-backend</code> <a class="citation" href="#openvalidationBackend">[7]</a>.
The first project wraps the opennvalidation-cli, which is written in Java, as an npm-package.
The second project deals with the problem I explained at the beginning: start the backend for the language-server with JavaScript.</p>

<p>You can find the package on npm and install it in your project like this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>node-java-connector
</code></pre></div></div>

<p>You then need to define a new file that should be named like <code class="highlighter-rouge">install.js</code> which calls the <code class="highlighter-rouge">install</code> method inside the package.
This can be written like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">njb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">node-java-connector</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">njb</span>
 <span class="p">.</span><span class="nx">install</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jre</span><span class="dl">"</span> <span class="p">})</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">dir</span> <span class="o">=&gt;</span> <span class="p">{})</span>
 <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
 <span class="p">});</span>
</code></pre></div></div>

<p>In your <code class="highlighter-rouge">package.json</code> you then need to define inside the <code class="highlighter-rouge">script</code> tag, that the file should be run while installing your project like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
 </span><span class="err">...</span><span class="w">
 </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"install"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node install.js"</span><span class="p">,</span><span class="w">
 </span><span class="p">}</span><span class="w">
 </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This handles the installing of the required JRE.
Now everything is set up and you can run the JAR by calling <code class="highlighter-rouge">executeJar</code>.</p>

<p>I would be interested in what you think about this.
Did you already struggle with a similar problem? And what was your solution?</p>

<p><strong>References</strong></p>
<ol class="bibliography">
<li><span id="launch4j">[1] G. Kowal, launch4j. http://launch4j.sourceforge.net/.<br> </span></li>
<li><span id="node-jre">[2] tilmankamp, npm: node-jre. https://www.npmjs.com/package/node-jre.<br> </span></li>
<li><span id="njre">[3] R. Thériault, npm: njre. https://www.npmjs.com/package/njre.<br> </span></li>
<li><span id="openJDK">[4] AdoptOpenJDK, AdoptOpenJDK API. https://api.adoptopenjdk.net/.<br> </span></li>
<li><span id="findJavaHome">[5] J. Spencer, npm: find-java-home. https://www.npmjs.com/package/find-java-home.<br> </span></li>
<li><span id="openvalidationNpm">[6] openVALIDATION, npm: openvalidation. https://www.npmjs.com/package/openvalidation.<br> </span></li>
<li><span id="openvalidationBackend">[7] openVALIDATION, npm: openvalidation-languageserver-backend. https://www.npmjs.com/package/openvalidation-languageserver-backend.<br> </span></li>
</ol>

  </div>
<script>
    if (window.cookieAccecpted) {
      document.write('<div id="disqus_thread" style="margin-top:25px"><\/div>');

      var disqus_config = function () {
        this.page.url = "https://www.nicolueg.com/node.js/java/backend/2020/01/26/run-java-with-node.html";
        this.page.identifier = "https://www.nicolueg.com/node.js/java/backend/2020/01/26/run-java-with-node.html";
      };
      (function () {
        var d = document,
          s = d.createElement("script");
        s.src =
          "https://nicolueg.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
      })();
      document.write(
        '<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.<\/a><\/noscript>'
      );
    }
  </script>
</div>

    </section>
</main><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>

<script>
    "use strict";
    // Instanciating InstantSearch.js with Algolia credentials
    var search = instantsearch({
        appId: "1TW92TYN2U",
        apiKey: "60be79fb752722f166d1c69a7b11932b",
        indexName: "my_blog",
        searchParameters: {
            restrictSearchableAttributes: ["title", "content"]
        },
        searchFunction: function searchFunction(helper) {
            var searchResults = document.querySelector(".search-hits");
            if (helper.state.query === "") {
                searchResults.style.display = "none";
                return;
            }
            helper.search();
            searchResults.style.display = "block";
        }
    });
    var hitTemplate = function hitTemplate(hit) {
        var url = hit.url;
        var title = hit._highlightResult.title.value;
        var content = hit._highlightResult.html.value;
        return (
            '<article class="entry"><h3 class="entry__title"><a href="' +
            url +
            '">' +
            title +
            '</a></h3><div class="entry__excerpt">' +
            content +
            "</div></article>"
        );
    };
    // Adding searchbar and results widgets
    search.addWidget(
        instantsearch.widgets.searchBox({
            container: ".search-searchbar",
            poweredBy: true,
            placeholder: "Search...",
            reset: true
        })
    );
    search.addWidget(
        instantsearch.widgets.hits({
            container: ".search-hits",
            templates: {
                empty: "<p>No results</p>",
                item: hitTemplate
            }
        })
    );

    $(".ais-search-box--reset-wrapper").on('click', function() {
        alert("hallo");
    });

    // Starting the search
    search.start();
</script>
</body>

</html>